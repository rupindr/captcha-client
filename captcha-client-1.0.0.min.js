var CaptchaClient=function(t,e){this.rootElement=t,this.apiUri="/"==e[e.length-1]?e.slice(0,e.length-1):e,this.checkCaptchaApiUri="/captcha-client/checkcaptcha",this.getCaptchaApiUri="/captcha-client/getcaptcha",this.captchaClientId="captcha-client-"+Math.random().toString(36).slice(-5),this.canvasId="captcha-canvas-"+Math.random().toString(36).slice(-5),this.userResId="user-response-"+Math.random().toString(36).slice(-5),this.submitBtnId="capthca-submit-"+Math.random().toString(36).slice(-5),this.reloadBtnId="capthca-reload-"+Math.random().toString(36).slice(-5),this.isPassed=!1,this.numberOfReloads=-1,this.test=void 0,this.fail=void 0,this.pass=void 0,this.load=void 0,this.reload=void 0,this.loadDOM=function(){this.rootElement.innerHTML="<div id="+this.captchaClientId+' style="border: 2px solid black;"><table style="width: 100%;"><tr><td colspan="3"><canvas id='+this.canvasId+'>Your browser does not support the HTML5 canvas tag.</canvas></td></tr><tr><td><input style="width: 90%;" id='+this.userResId+' type="text"></input></td><td><button id='+this.submitBtnId+">Submit</button></td><td><button id="+this.reloadBtnId+">&#x21bb;</button></td></tr></table></div>",document.getElementById(this.submitBtnId).addEventListener("click",this.captchaCheck),document.getElementById(this.reloadBtnId).addEventListener("click",this.loadCaptcha)}.bind(this),this.loadCaptcha=function(){this.numberOfReloads=this.numberOfReloads+1;var t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&200==t.status&&this.processPixelData(JSON.parse(t.responseText))}.bind(this),t.open("GET",this.apiUri+this.getCaptchaApiUri,!0),t.send()}.bind(this),this.processPixelData=function(t){var e=document.getElementById(this.canvasId).getContext("2d"),s=e.createImageData(t.width,t.height);e.canvas.height=t.height,e.canvas.width=t.width,document.getElementById(this.captchaClientId).style.width=t.width+10+"px",t.width<120&&(document.getElementById(this.submitBtnId).innerHTML="&#10004");for(var i=s.data.length-1;i>=0;i--)t.imgData[i]?s.data[i]=t.imgData[i]:s.data[i]=0;e.putImageData(s,0,0),document.getElementById(this.userResId).value="",document.getElementById(this.userResId).focus(),this.load&&0==this.numberOfReloads&&this.load(),this.reload&&this.numberOfReloads>0&&this.reload()}.bind(this),this.captchaCheck=function(){var t=new XMLHttpRequest,e=document.getElementById(this.userResId).value;t.onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&200==t.status&&this.handleCaptchaResponse(JSON.parse(t.responseText))}.bind(this),t.open("POST",this.apiUri+this.checkCaptchaApiUri,!0),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(JSON.stringify({answer:e}))}.bind(this),this.handleCaptchaResponse=function(t){"passed"===t.status?(this.isPassed=!0,document.getElementById(this.captchaClientId).style.borderColor="green",document.getElementById(this.userResId).disabled="true",document.getElementById(this.reloadBtnId).disabled="true",document.getElementById(this.submitBtnId).disabled="true",this.pass&&this.pass()):(this.isPassed=!1,document.getElementById(this.captchaClientId).style.borderColor="red",document.getElementById(this.userResId).value="",document.getElementById(this.userResId).focus(),this.fail&&this.fail(),this.loadCaptcha()),this.test&&this.test(this.isPassed)}.bind(this),this.on=function(t,e){"function"==typeof e&&("test"==t&&(this.test=e),"load"==t&&(this.load=e),"fail"==t&&(this.fail=e),"pass"==t&&(this.pass=e),"reload"==t&&(this.reload=e))},this.loadDOM(),this.loadCaptcha()};